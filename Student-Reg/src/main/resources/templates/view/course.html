<!DOCTYPE html>
<html lang="en">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" >
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/fontawesome.min.css">
    <style>
        .imagecontainer{
            position: relative;
            width: 100%;
            max-width: 400px;

        }

        .overlay{
            position: absolute;
            top: 0;
            bottom: 0;
            left: 0;
            right: 0;
            height: 100%;
            width: 100%;
            opacity: 0;
            transition: 3s ease;
            border-radius: 50%;
        }

        .imagecontainer:hover .overlay{
            opacity: 1;
        }
        .icon{
            color: white;
            font-size: 40px;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%,-50%);
            -ms-transform:translate(-50%,-50%);
            text-align: center;

        }

        .fa-trash:hover{
            color: red;

        }
    </style>

    <title>Courses</title>
</head>
<body>

<div class="container-fluid">
    <div class="row">
        <div class="col-md-12">
            <h2>Course Management</h2>
            <div class="alert alert-success alert-dismissible" th:if="${successmassage}">
                <button type="button" class="close" data-dismiss="alert">&times;</button>
                <strong th:text="${successmassage}"></strong>
            </div>
            <div class="alert alert-danger alert-dismissible" th:if="${errormessage}">
                <button type="button" class="close" data-dismiss="alert">&times;</button>
                <strong th:text="${errormessage}"></strong>
            </div>
            <form action="#" th:action="@{${isAdd}? '/save':'/update'}" th:object="${course}" method="post" enctype="multipart/form-data" >
                <div class="form-group">
                    <input type="text" class="form-control" id="courseName" placeholder="Course name" th:field="*{courseName}">
                </div>
                <div class="form-group">
                    <input type="text" class="form-control" id="courseCode" placeholder="Course code" th:field="*{courseCode}">
                </div>
                <div class="form-group">
                    <input type="text" class="form-control" id="courseDescription" placeholder="Course description" th:field="*{courseDescription}">
                </div>
                <div class="form-group">
                    <input type="text" class="form-control" id="courseDuration" placeholder="Course duration" th:field="*{courseDuration}">
                </div>
                <div class="form-group">
                    <input type="file" class="form-control" id="files" placeholder="Upload Tutorials" th:field="*{files}" multiple="multiple">
                </div>


                <div class="form-group">
                    <span th:each ="file, itrStat : ${courseFiles}"  class = "imagecontainer" th:id = "'imageindex'+${itrStat.index}">
                        <img th:src="@{'/images/'+${file.modifiedFileName}}" style="width: 80px; height: 80px; margin-left: 10px;" class="image" th:if="${file.fileExtension != 'pdf' and file.fileExtension != 'xls' and file.fileExtension != 'xlsx' }">
                        <img th:src="@{'/img/pdf.png/'}" style="width: 80px; height: 80px; margin-left: 10px;" class="image" th:if="${file.fileExtension == 'pdf'  }">
                        <img th:src="@{'/img/excel.png/'}" style="width: 80px; height: 80px; margin-left: 10px;" class="image" th:if="${file.fileExtension == 'xls' or file.fileExtension == 'xlsx'  }">
                        <span class="overlay">
                            <a href="#" class="icon image-confirm-delete" title="image delete" th:attr="data-id=${itrStat.index},data-name=${file.modifiedFileName}">
                                <i class="fa fa-trash" style="color: red;"></i>
                            </a>
                        </span>
                    </span>
                </div>

                <input type="hidden" class="form-control" th:field="*{removeImages}" id="removeImages">
                <input type="hidden" class="form-control" th:field = "*{courseId}" >



                <div class="form-group">
                    <button type="submit" class="btn btn-primary" th:text="${isAdd}? 'Save' : 'Update'">Save</button>
                </div>

            </form>
            <hr/>
        </div>
        <div class="col-md-12">
            <h2>ALl courses</h2>
            <div style="margin-top: 20px;">
                <table class="table table-striped table-bordered" style="width: 100%">
                    <thead>
                    <tr>
                        <th>Course name</th>
                        <th>Course code</th>
                        <th>Course description</th>
                        <th>Course duration</th>
                        <th>Action</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr th:each="course:${courses}">
                        <td th:text="${course.courseName}"></td>
                        <td th:text="${course.courseCode}"></td>
                        <td th:text="${course.courseDescription}"></td>
                        <td th:text="${course.courseDuration}"></td>
                        <td>
                            <a th:href="@{'/editcourse/'+${course.courseId}}"><i class="fa fa-edit" style="font-size: 21px;"></i> </a>
                            <a href="#" class="confirm-delete"  th:attr="data-id=${course.courseId},data-name=${course.courseName}"></a>
                            <i class="fa fa-trash" style="font-size: 21px;color: red;"></i>

                        </td>

                    </tr>
                    </tbody>
                </table>

            </div>

        </div>
    </div>
</div>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" ></script>
<script type="text/javascript">
    $(function (){
        var images  = [];
        $('.image-confirm-delete').on('click',function (e){
            e.preventDefault();
            var id = $(this).data('id');
            var name =$(this).data('name');
            images.push(name);
            $('#removeImages').val(images);
            $('#imageindex'+id).hide();

        });

        $('.confirm-delete').on('click',function (e){
            e.preventDefault();
            var id = $(this).data('id');
            var name =$(this).data('name');
            $("#modal-name").html(name);
            $("#idModalLink").attr('href','/deleteuser/'+id);
            $("#myModal").modal();


        });
    });
</script>

<div class="modal-fade" id="myModal" tabindex="-1" aria-labelledby="myModallabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-body" id="myModalBody">
                <p>Do you want to delete this (<span id="modal-name"></span>) record?</p>
            </div>
            <div class="modal-footer">
                <a id="idModalLink" href="#" class="btn btn-primary">yes</a>
                <button type="button" class="btn btn-default" data-dismiss="modal">No</button>
            </div>
        </div>
    </div>

</div>

</body>
</html>